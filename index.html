<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FRECOLI | Fragr√¢ncias & Acess√≥rios de Luxo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="shortcut icon" href="icone.ico" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Montserrat:wght@200;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #D4AF37;
            --silver: #C0C0C0;
            --dark: #000000;
        }

        * {
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
        }

        body {
            background-color: var(--dark);
            color: #f4f4f5;
            font-family: 'Montserrat', sans-serif;
            margin: 0;
            overflow-x: hidden;
        }

        .font-serif { font-family: 'Playfair Display', serif; }

        .text-luxury {
            background: linear-gradient(135deg, #D4AF37 0%, #E5E7EB 50%, #D4AF37 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .bg-gold-silver {
            background: linear-gradient(135deg, #B8860B 0%, #C0C0C0 50%, #B8860B 100%);
        }

        .input-luxury {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(192, 192, 192, 0.2);
            color: white;
            padding: 1rem;
            border-radius: 0.75rem;
            width: 100%;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .input-luxury:focus {
            outline: none;
            border-color: var(--gold);
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
            opacity: 0;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card-glass {
            background: linear-gradient(145deg, #0f0f0f, #050505);
            border: 1px solid rgba(212, 175, 55, 0.15);
        }

        .btn-main {
            background: var(--dark);
            border: 1px solid var(--gold);
            color: white;
            transition: all 0.4s;
            position: relative;
        }

        .btn-main:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="toast"></div>

    <!-- HEADER -->
    <header class="sticky top-0 z-50 bg-black/95 backdrop-blur-md border-b border-white/5 px-4 md:px-12 py-4 flex justify-between items-center">
        <div class="text-lg md:text-2xl font-bold tracking-[0.3em] text-luxury uppercase cursor-pointer" onclick="location.reload()">Frecoli</div>
        <div class="flex items-center gap-3 md:gap-6">
            <button onclick="toggleAdminPanel()" class="text-[8px] md:text-[10px] uppercase tracking-widest text-gray-500 hover:text-white transition">ADM</button>
            <div class="relative cursor-pointer p-2" onclick="openCart()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 md:h-6 md:w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                </svg>
                <span id="cart-count" class="absolute top-0 right-0 bg-gold-silver text-black text-[9px] font-bold px-1.5 rounded-full min-w-[16px] h-[16px] flex items-center justify-center">0</span>
            </div>
        </div>
    </header>

    <main class="flex-grow flex flex-col">
        
        <!-- QUIZ SECTIONS -->
        <section id="quiz-section" class="flex-grow flex flex-col items-center justify-center px-4 py-16 text-center">
            <div id="quiz-intro" class="fade-in max-w-2xl">
                <span class="text-[9px] uppercase tracking-[0.4em] text-gold mb-4 block">Sele√ß√£o Personalizada</span>
                <h1 class="text-4xl md:text-7xl mb-6 font-serif italic text-luxury leading-tight">Encontre a sua Ess√™ncia</h1>
                <p class="text-gray-400 text-sm md:text-lg font-light mb-10">Descubra qual fragr√¢ncia combina melhor com o seu estilo.</p>
                <button onclick="startQuiz()" class="btn-main px-10 py-4 rounded-full text-xs uppercase tracking-[0.2em] font-semibold">Come√ßar Consultoria</button>
            </div>

            <div id="quiz-container" class="hidden w-full max-w-lg card-glass p-6 md:p-10 rounded-2xl fade-in">
                <div class="flex items-center justify-between mb-8 text-[9px] uppercase tracking-widest text-silver">
                    <span id="question-count">Quest√£o 1 de 3</span>
                </div>
                <h2 id="question-text" class="text-xl md:text-2xl mb-8 font-serif text-white italic"></h2>
                <div id="options-grid" class="grid grid-cols-1 gap-3"></div>
            </div>
        </section>

        <!-- LEAD SECTION -->
        <section id="lead-section" class="hidden flex-grow flex items-center justify-center px-4 py-10">
            <div class="w-full max-w-md card-glass p-8 rounded-3xl text-center fade-in">
                <h2 class="text-2xl mb-2 text-luxury font-serif italic">Identifica√ß√£o</h2>
                <p class="text-gray-500 text-[10px] uppercase mb-8 tracking-widest">Para personalizar a sua experi√™ncia</p>
                <form onsubmit="handleLead(event)" class="space-y-6 text-left">
                    <div class="space-y-1">
                        <label class="text-[9px] uppercase tracking-widest text-silver ml-1">Seu Nome</label>
                        <input type="text" id="lead-name" required class="input-luxury" placeholder="Ex: Jo√£o Silva">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[9px] uppercase tracking-widest text-silver ml-1">WhatsApp</label>
                        <input type="tel" id="lead-phone" required class="input-luxury" placeholder="Ex: 959481506">
                    </div>
                    <button type="submit" class="w-full btn-main py-4 rounded-xl text-xs uppercase tracking-[0.3em] font-bold mt-4">Ver Cat√°logo</button>
                </form>
            </div>
        </section>

        <!-- CATALOG -->
        <section id="catalog-section" class="hidden px-4 md:px-12 py-12">
            <div class="max-w-7xl mx-auto">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-6xl text-luxury font-serif italic mb-2">Cat√°logo Exclusivo</h2>
                    <p class="text-[10px] uppercase tracking-[0.3em] text-gray-500">Sele√ß√£o para <span id="user-name-display" class="text-white"></span></p>
                </div>
                <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
                <div id="catalog-loader" class="flex justify-center py-20 hidden">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-gold"></div>
                </div>
            </div>
        </section>
    </main>

    <!-- FOOTER -->
    <footer class="bg-black border-t border-white/5 py-12 px-6">
        <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-10 text-center md:text-left">
            <div>
                <div class="text-xl font-bold tracking-[0.3em] text-luxury uppercase mb-4">Frecoli</div>
                <p class="text-[10px] text-gray-500 leading-relaxed uppercase tracking-widest">O Luxo nos detalhes, a alma na fragr√¢ncia. Especialistas em perfumaria de elite e acess√≥rios exclusivos.</p>
            </div>
            <div class="text-[11px] text-gray-400 space-y-3">
                <p class="uppercase tracking-widest text-gold mb-2 font-bold">Contacto Oficial</p>
                <div class="flex items-center justify-center md:justify-start gap-2">
                    <span>üá¶üá¥</span>
                    <span>+244 959 481 506</span>
                </div>
                <p>colifinance99@gmail.com</p>
                <p>Luanda, Angola</p>
            </div>
            <div class="flex flex-col justify-between items-center md:items-end">
                <div class="flex gap-4 mb-6">
                    <div class="w-8 h-8 rounded-full border border-zinc-800 flex items-center justify-center text-silver text-[10px]">IG</div>
                    <div class="w-8 h-8 rounded-full border border-zinc-800 flex items-center justify-center text-silver text-[10px]">FB</div>
                    <div class="w-8 h-8 rounded-full border border-zinc-800 flex items-center justify-center text-silver text-[10px]">WA</div>
                </div>
                <div class="text-[9px] text-zinc-700 uppercase tracking-[0.4em]">
                    ¬© 2024 FRECOLI LUXURY ‚Ä¢ ANGOLA
                </div>
            </div>
        </div>
    </footer>

    <!-- MODALS (ADMIN, CART) -->
    <div id="admin-modal" class="hidden fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/90">
        <div class="bg-zinc-900 w-full max-w-2xl rounded-2xl border border-white/10 overflow-hidden flex flex-col max-h-[90vh]">
            <div class="p-5 bg-black flex justify-between items-center border-b border-gold/30">
                <span class="text-[10px] uppercase tracking-[0.3em] text-gold">Gest√£o Administrativa</span>
                <button onclick="toggleAdminPanel()" class="text-white text-2xl">&times;</button>
            </div>
            
            <div id="admin-login" class="p-10 text-center">
                <input type="password" id="admin-pass" class="input-luxury text-center mb-6" placeholder="Senha de Acesso">
                <button onclick="verifyAdmin()" class="w-full btn-main py-3 rounded-lg text-[10px] uppercase tracking-widest font-bold">Aceder</button>
            </div>

            <div id="admin-dashboard" class="hidden p-6 overflow-y-auto">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-4">
                        <h4 class="text-[10px] uppercase tracking-widest text-silver mb-4">Novo Item</h4>
                        <input type="text" id="p-name" placeholder="Nome" class="input-luxury">
                        <input type="text" id="p-price" placeholder="Pre√ßo (ex: 45.000 Kz)" class="input-luxury">
                        <textarea id="p-desc" placeholder="Descri√ß√£o" class="input-luxury h-20"></textarea>
                        <input type="file" id="p-img-file" accept="image/*" class="text-[10px] text-gray-500">
                        <button id="btn-publish" onclick="createProduct()" class="w-full btn-main py-4 rounded-xl text-[10px] uppercase tracking-widest font-bold">Publicar Produto</button>
                    </div>
                    <div>
                        <h4 class="text-[10px] uppercase tracking-widest text-silver mb-4">Stock Atual</h4>
                        <div id="admin-products-list" class="space-y-2"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="cart-modal" class="hidden fixed inset-0 z-[60] flex justify-end bg-black/80">
        <div class="bg-zinc-950 w-full max-w-sm h-full shadow-2xl flex flex-col border-l border-white/10">
            <div class="p-6 bg-black flex justify-between items-center border-b border-white/5">
                <h3 class="text-lg font-serif text-luxury italic">Minha Cesta</h3>
                <button onclick="closeCart()" class="text-white text-3xl font-light">&times;</button>
            </div>
            <div id="cart-items" class="flex-grow overflow-y-auto p-6 space-y-4"></div>
            <div class="p-6 border-t border-white/5 bg-black">
                <button onclick="checkout()" class="w-full btn-main py-4 rounded-xl uppercase tracking-widest text-[10px] font-bold">Finalizar no WhatsApp</button>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://zfhuomzkmwquqnrfzspj.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpmaHVvbXprbXdxdXFucmZ6c3BqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwMTg1NjQsImV4cCI6MjA4NjU5NDU2NH0.786i5uhC4TbafTa3ZPAv6UCBu47b_pnhE_rAejXrJAs';

        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let products = [];
        let cart = [];
        let userData = { name: '', phone: '' };
        let currentQIdx = 0;

        function showToast(msg, error = false) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.display = 'block';
            t.style.backgroundColor = error ? '#7f1d1d' : '#14532d';
            t.style.color = 'white';
            setTimeout(() => t.style.display = 'none', 4000);
        }

        const quizQuestions = [
            { t: "Quem ir√° usar o perfume?", o: ["Eu Pr√≥prio", "Presente Especial"] },
            { t: "Qual o seu estilo?", o: ["Discreto/Fresco", "Intenso/Marcante", "Cl√°ssico"] },
            { t: "Para que ocasi√£o?", o: ["Uso Di√°rio", "Eventos/Noite", "Trabalho"] }
        ];

        function startQuiz() {
            document.getElementById('quiz-intro').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            renderQuestion();
        }

        function renderQuestion() {
            const q = quizQuestions[currentQIdx];
            document.getElementById('question-count').innerText = `Quest√£o ${currentQIdx + 1} de 3`;
            document.getElementById('question-text').innerText = q.t;
            const grid = document.getElementById('options-grid');
            grid.innerHTML = '';
            q.o.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left p-4 rounded-xl border border-white/5 bg-white/[0.02] text-[11px] uppercase tracking-wider text-gray-300 hover:border-gold transition-all";
                btn.innerText = opt;
                btn.onclick = () => {
                    if(currentQIdx < quizQuestions.length - 1) { currentQIdx++; renderQuestion(); }
                    else { showLead(); }
                };
                grid.appendChild(btn);
            });
        }

        function showLead() {
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('lead-section').classList.remove('hidden');
        }

        async function handleLead(e) {
            e.preventDefault();
            userData.name = document.getElementById('lead-name').value;
            userData.phone = document.getElementById('lead-phone').value;
            document.getElementById('lead-section').classList.add('hidden');
            document.getElementById('catalog-section').classList.remove('hidden');
            document.getElementById('user-name-display').innerText = userData.name;
            fetchProducts();
        }

        async function fetchProducts() {
            document.getElementById('catalog-loader').classList.remove('hidden');
            const { data, error } = await _supabase.from('produtos').select('*').order('created_at', { ascending: false });
            document.getElementById('catalog-loader').classList.add('hidden');
            if (error) {
                console.error("Erro na busca:", error);
                showToast("Erro ao carregar produtos", true);
            } else {
                products = data || [];
                renderCatalog();
                if(!document.getElementById('admin-dashboard').classList.contains('hidden')) renderAdminList();
            }
        }

        function renderCatalog() {
            const grid = document.getElementById('products-grid');
            grid.innerHTML = '';
            products.forEach((p, idx) => {
                grid.innerHTML += `
                    <div class="card-glass rounded-2xl overflow-hidden fade-in">
                        <img src="${p.imagem_url}" class="w-full aspect-[4/5] object-cover">
                        <div class="p-5">
                            <h3 class="text-xs font-serif text-luxury italic mb-1 uppercase tracking-widest">${p.nome}</h3>
                            <div class="flex items-center justify-between mt-4">
                                <span class="text-xs font-bold text-white">${p.preco}</span>
                                <button onclick="addToCart(${idx})" class="text-[8px] border border-gold px-4 py-1.5 rounded-full uppercase tracking-widest hover:bg-gold hover:text-black transition">Adicionar</button>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        function addToCart(idx) { cart.push(products[idx]); updateCart(); showToast("Item adicionado"); }
        function updateCart() {
            document.getElementById('cart-count').innerText = cart.length;
            const container = document.getElementById('cart-items');
            container.innerHTML = '';
            cart.forEach((item, i) => {
                container.innerHTML += `
                    <div class="flex items-center gap-4 bg-white/5 p-3 rounded-xl">
                        <img src="${item.imagem_url}" class="w-10 h-10 object-cover rounded-lg">
                        <div class="flex-grow"><p class="text-[10px] text-white uppercase">${item.nome}</p></div>
                        <button onclick="cart.splice(${i}, 1); updateCart();" class="text-gray-500">&times;</button>
                    </div>`;
            });
        }

        function openCart() { document.getElementById('cart-modal').classList.remove('hidden'); }
        function closeCart() { document.getElementById('cart-modal').classList.add('hidden'); }

        function checkout() {
            let msg = `*PEDIDO FRECOLI*%0ACliente: ${userData.name}%0A%0A`;
            cart.forEach(i => msg += `‚Ä¢ ${i.nome} - ${i.preco}%0A`);
            window.open(`https://wa.me/244959481506?text=${msg}`);
        }

        function toggleAdminPanel() { document.getElementById('admin-modal').classList.toggle('hidden'); }
        function verifyAdmin() {
            if(document.getElementById('admin-pass').value === "FRECOLI2024") {
                document.getElementById('admin-login').classList.add('hidden');
                document.getElementById('admin-dashboard').classList.remove('hidden');
                fetchProducts();
            } else showToast("Senha Inv√°lida", true);
        }

        async function createProduct() {
            const btn = document.getElementById('btn-publish');
            const name = document.getElementById('p-name').value;
            const price = document.getElementById('p-price').value;
            const file = document.getElementById('p-img-file').files[0];

            if(!name || !price || !file) return showToast("Faltam dados", true);

            btn.disabled = true;
            btn.innerText = "A PUBLICAR...";

            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async () => {
                const { error } = await _supabase.from('produtos').insert([{ nome: name, preco: price, imagem_url: reader.result }]);
                if (error) {
                    console.error("Erro insert:", error);
                    showToast("Erro: " + error.message, true);
                    btn.disabled = false;
                    btn.innerText = "Publicar Produto";
                } else {
                    showToast("Sucesso!");
                    location.reload();
                }
            };
        }

        function renderAdminList() {
            const list = document.getElementById('admin-products-list');
            list.innerHTML = '';
            products.forEach(p => {
                list.innerHTML += `
                    <div class="p-3 bg-black flex justify-between items-center rounded-lg border border-white/5 text-[9px] uppercase">
                        <span class="text-white truncate max-w-[150px]">${p.nome}</span>
                        <button onclick="deleteProd(${p.id}, this)" class="text-red-500 hover:text-red-300 transition-colors px-2 py-1">Apagar</button>
                    </div>`;
            });
        }

        async function deleteProd(id, btn) {
            if(!confirm("Tem certeza que deseja apagar este produto definitivamente?")) return;
            
            // Feedback imediato no bot√£o
            const originalText = btn.innerText;
            btn.innerText = "...";
            btn.disabled = true;

            try {
                const { error } = await _supabase
                    .from('produtos')
                    .delete()
                    .eq('id', id);

                if (error) {
                    console.error("Erro ao apagar:", error);
                    showToast("Erro: " + error.message, true);
                    btn.innerText = originalText;
                    btn.disabled = false;
                } else {
                    showToast("Produto removido com sucesso!");
                    // Recarrega os dados para atualizar as duas listas
                    await fetchProducts();
                }
            } catch (err) {
                console.error("Erro inesperado:", err);
                showToast("Erro de rede ao apagar", true);
                btn.innerText = originalText;
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
